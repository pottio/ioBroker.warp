{
  "version": 3,
  "sources": ["../src/main.ts"],
  "sourcesContent": ["import * as utils from '@iobroker/adapter-core';\r\nimport { ContextLogger } from './lib/context-logger';\r\nimport { WarpService } from './warp/warp-service';\r\nimport { Encryption } from './lib/crypto';\r\nexport class WarpAdapter extends utils.Adapter {\r\n\tprivate readonly _log: ContextLogger;\r\n\tprivate readonly _warpService: WarpService;\r\n\r\n\tpublic constructor(options: Partial<utils.AdapterOptions> = {}) {\r\n\t\tsuper({\r\n\t\t\t...options,\r\n\t\t\tname: 'warp',\r\n\t\t});\r\n\r\n\t\tthis._log = new ContextLogger(this, 'Main');\r\n\t\tthis._warpService = new WarpService(this);\r\n\r\n\t\tthis.on('ready', this.onReadyAsync.bind(this));\r\n\t\tthis.on('stateChange', this.onStateChangeAsync.bind(this));\r\n\t\tthis.on('unload', this.onUnloadAsync.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * Is called when databases are connected and adapter received configuration.\r\n\t */\r\n\tprivate async onReadyAsync(): Promise<void> {\r\n\t\tthis._log.info('Start initializing WARP adapter');\r\n\t\ttry {\r\n\t\t\tawait this.setStateAsync('info.connection', false, true);\r\n\r\n\t\t\tif (this.config.authEnabled) {\r\n\t\t\t\tthis._log.debug('Auth enabled. Decrypt password');\r\n\t\t\t\tthis.config.password = await Encryption.decrypt(this, this.config.password);\r\n\t\t\t}\r\n\r\n\t\t\tconst version = await this.getStateAsync('info.version');\r\n\t\t\tthis._log.debug(`Adapter version on last adapter execution: '${version?.val}'`);\r\n\r\n\t\t\tconst product = await this.getStateAsync('info.product');\r\n\t\t\tconst model = await this.getStateAsync('info.model');\r\n\t\t\tconst configurationChanged = this.config.product !== product?.val || this.config.model !== model?.val;\r\n\t\t\tif (configurationChanged) this._log.debug(`Configuration changed. Product: '${product?.val}' -> '${this.config.product}' | Model: '${model?.val}' -> '${this.config.model}'`);\r\n\r\n\t\t\tawait this._warpService.initAsync(configurationChanged, <string>(version?.val ?? '0.0.0'));\r\n\r\n\t\t\tawait this.setStateAsync('info.product', this.config.product, true);\r\n\t\t\tawait this.setStateAsync('info.model', this.config.model, true);\r\n\t\t\tawait this.setStateAsync('info.version', this.version, true);\r\n\t\t} catch (e) {\r\n\t\t\tthis._log.error('Initializing failed', e)\r\n\t\t}\r\n\t\tthis._log.info('WARP adapter initialized');\r\n\t}\r\n\r\n\t/**\r\n\t * Is called when adapter shuts down - callback has to be called under any circumstances!\r\n\t */\r\n\tprivate async onUnloadAsync(callback: () => void): Promise<void> {\r\n\t\ttry {\r\n\t\t\tthis._log.info('Shutting down WARP adapter');\r\n\t\t\tawait this._warpService.terminateAsync();\r\n\t\t\tcallback();\r\n\t\t} catch (e) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Is called if a subscribed state changes\r\n\t */\r\n\tprivate async onStateChangeAsync(id: string, state: ioBroker.State | null | undefined): Promise<void> {\r\n\t\tif (state) {\r\n\t\t\tthis._warpService.handleStateChangedAsync(id, state);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif (require.main !== module) {\r\n\t// Export the constructor in compact mode\r\n\tmodule.exports = (options: Partial<utils.AdapterOptions> | undefined) => new WarpAdapter(options);\r\n} else {\r\n\t// otherwise start the instance directly\r\n\t(() => new WarpAdapter())();\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAAuB;AACvB,4BAA8B;AAC9B,0BAA4B;AAC5B,oBAA2B;AACpB,MAAM,oBAAoB,MAAM,QAAQ;AAAA,EAIvC,YAAY,UAAyC,CAAC,GAAG;AAC/D,UAAM,iCACF,UADE;AAAA,MAEL,MAAM;AAAA,IACP,EAAC;AAED,SAAK,OAAO,IAAI,oCAAc,MAAM,MAAM;AAC1C,SAAK,eAAe,IAAI,gCAAY,IAAI;AAExC,SAAK,GAAG,SAAS,KAAK,aAAa,KAAK,IAAI,CAAC;AAC7C,SAAK,GAAG,eAAe,KAAK,mBAAmB,KAAK,IAAI,CAAC;AACzD,SAAK,GAAG,UAAU,KAAK,cAAc,KAAK,IAAI,CAAC;AAAA,EAChD;AAAA,QAKc,eAA8B;AAzB7C;AA0BE,SAAK,KAAK,KAAK,iCAAiC;AAChD,QAAI;AACH,YAAM,KAAK,cAAc,mBAAmB,OAAO,IAAI;AAEvD,UAAI,KAAK,OAAO,aAAa;AAC5B,aAAK,KAAK,MAAM,gCAAgC;AAChD,aAAK,OAAO,WAAW,MAAM,yBAAW,QAAQ,MAAM,KAAK,OAAO,QAAQ;AAAA,MAC3E;AAEA,YAAM,UAAU,MAAM,KAAK,cAAc,cAAc;AACvD,WAAK,KAAK,MAAM,+CAA+C,mCAAS,MAAM;AAE9E,YAAM,UAAU,MAAM,KAAK,cAAc,cAAc;AACvD,YAAM,QAAQ,MAAM,KAAK,cAAc,YAAY;AACnD,YAAM,uBAAuB,KAAK,OAAO,YAAY,oCAAS,QAAO,KAAK,OAAO,UAAU,gCAAO;AAClG,UAAI;AAAsB,aAAK,KAAK,MAAM,oCAAoC,mCAAS,YAAY,KAAK,OAAO,sBAAsB,+BAAO,YAAY,KAAK,OAAO,QAAQ;AAE5K,YAAM,KAAK,aAAa,UAAU,sBAA+B,yCAAS,QAAT,YAAgB,OAAQ;AAEzF,YAAM,KAAK,cAAc,gBAAgB,KAAK,OAAO,SAAS,IAAI;AAClE,YAAM,KAAK,cAAc,cAAc,KAAK,OAAO,OAAO,IAAI;AAC9D,YAAM,KAAK,cAAc,gBAAgB,KAAK,SAAS,IAAI;AAAA,IAC5D,SAAS,GAAP;AACD,WAAK,KAAK,MAAM,uBAAuB,CAAC;AAAA,IACzC;AACA,SAAK,KAAK,KAAK,0BAA0B;AAAA,EAC1C;AAAA,QAKc,cAAc,UAAqC;AAChE,QAAI;AACH,WAAK,KAAK,KAAK,4BAA4B;AAC3C,YAAM,KAAK,aAAa,eAAe;AACvC,eAAS;AAAA,IACV,SAAS,GAAP;AACD,eAAS;AAAA,IACV;AAAA,EACD;AAAA,QAKc,mBAAmB,IAAY,OAAyD;AACrG,QAAI,OAAO;AACV,WAAK,aAAa,wBAAwB,IAAI,KAAK;AAAA,IACpD;AAAA,EACD;AACD;AAEA,IAAI,QAAQ,SAAS,QAAQ;AAE5B,SAAO,UAAU,CAAC,YAAuD,IAAI,YAAY,OAAO;AACjG,OAAO;AAEN,EAAC,OAAM,IAAI,YAAY,GAAG;AAC3B;",
  "names": []
}
